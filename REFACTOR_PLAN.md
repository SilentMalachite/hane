# Editor.App.hs リファクタリング計画

## 現状の問題点

1. **単一責任の原則違反**: UI描画、イベント処理、バッファ操作、ファイルダイアログが一つのファイルに混在
2. **ファイルサイズ**: 437行と大きく、保守性が低下
3. **責務分離の欠如**: 異なる機能が密結合している

## リファクタリング案

### 1. モジュール分割

#### Editor.App.UI
- UI描画に関する関数を集約
- `drawUI`, `drawMainUI`, `drawBufferWithCursor`, `drawFileDialog` などを移動

#### Editor.App.State
- 状態管理に関する関数を集約
- `getCurrentBuffer`, `setCurrentBuffer`, `insertChar`, `deleteChar` などを移動

#### Editor.App.Event
- イベント処理に関する関数を集約
- `handleFileDialogEvent`, `appEvent` などを移動

#### Editor.App.Core
- アプリケーションコア機能を残す
- `St` データ型、`run` 関数、`app` などを保持

### 2. 実装手順

1. **Editor.App.UI モジュール作成**
   - UI関連関数を分離
   - エクスポートリストを明確に定義

2. **Editor.App.State モジュール作成**
   - 状態操作関数を分離
   - バッファ操作、カーソル移動などを集約

3. **Editor.App.Event モジュール作成**
   - イベント処理を分離
   - キーボードイベント、ファイル操作イベントなどを集約

4. **Editor.App コアモジュールの整理**
   - 各モジュールをインポート
   - 不要なコードを削除
   - インターフェースを整理

### 3. 期待される効果

- **保守性向上**: 機能ごとに分割され、変更の影響範囲が明確になる
- **テスト容易性**: 各モジュールを独立してテスト可能になる
- **可読性向上**: コードの意図が明確になり、新規開発者が理解しやすくなる
- **再利用性**: 他のプロジェクトでUIや状態管理を再利用可能になる

### 4. 注意点

- 循環依存を避けること
- パブリックインターフェースを慎重に設計すること
- 既存のテストがすべて通ることを確認すること
- 段階的にリファクタリングを行い、各段階で動作確認すること